<div id="minimap">
  <canvas id="minimapCanvas"></canvas>
  <div id="viewbox"></div>
</div>

<style>
#minimap {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 250px;
  height: 50px; /* Höhe auf 1/3 reduziert */
  border: 2px solid rgba(255,255,255,0.5);
  background: rgba(0,0,0,0.2);
  overflow: hidden;
  border-radius: 10px;
  z-index: 50;
}
#minimap canvas {
  width: 100%;
  height: 100%;
  display: block;
}
#viewbox {
  position: absolute;
  border: 2px solid #00c3ff;
  background: rgba(0,195,255,0.2);
  pointer-events: none;
  z-index: 60;
}
</style>

<script>
const minimap = document.getElementById('minimap');
const canvas = document.getElementById('minimapCanvas');
const ctx = canvas.getContext('2d');
const viewbox = document.getElementById('viewbox');
const images = Array.from(timeline.children); // Die 17 Bilder

function drawMinimap() {
  const w = canvas.width = minimap.clientWidth;
  const h = canvas.height = minimap.clientHeight;

  ctx.clearRect(0, 0, w, h);

  const fullWidth = timeline.scrollWidth;
  const scaleFactor = w / fullWidth;

  // Miniaturbilder nebeneinander
  images.forEach(img => {
    const x = img.offsetLeft * scaleFactor;
    const imgWidth = img.offsetWidth * scaleFactor;
    const imgHeight = img.offsetHeight * scaleFactor * (h / timeline.scrollHeight); // proportionale Höhe

    if (img.complete) {
      ctx.drawImage(img, x, 0, imgWidth, h);
    } else {
      img.onload = () => ctx.drawImage(img, x, 0, imgWidth, h);
    }
  });

  // Sichtbarer Ausschnitt
  const visibleX = -translateX / targetScale;
  const visibleW = wrapper.clientWidth / targetScale;

  viewbox.style.left = visibleX * scaleFactor + minimap.offsetLeft + "px";
  viewbox.style.top = minimap.offsetTop + "px";
  viewbox.style.width = visibleW * scaleFactor + "px";
  viewbox.style.height = h + "px";
}

// Klick auf MiniMap → Springe zur Position
minimap.addEventListener('click', e => {
  const rect = minimap.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const scaleFactor = rect.width / timeline.scrollWidth;

  const targetX = -x / scaleFactor * targetScale + rect.width / 2;
  targetTranslateX = targetX;
  applyBounds();
});

function updateMinimap() {
  drawMinimap();
  requestAnimationFrame(updateMinimap);
}
updateMinimap();
</script>
