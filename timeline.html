<div id="minimap">
  <canvas id="minimapCanvas"></canvas>
  <div id="viewbox"></div>
</div>

<style>
#minimap {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 250px;
  height: 50px; /* 1/3 der HÃ¶he */
  border: 2px solid rgba(255,255,255,0.5);
  background: rgba(0,0,0,0.2);
  overflow: hidden;
  border-radius: 10px;
  z-index: 50;
}
#minimap canvas {
  width: 100%;
  height: 100%;
  display: block;
}
#viewbox {
  position: absolute;
  border: 2px solid #00c3ff;
  background: rgba(0,195,255,0.2);
  pointer-events: none;
  z-index: 60;
}
</style>

<script>
const minimap = document.getElementById('minimap');
const canvas = document.getElementById('minimapCanvas');
const ctx = canvas.getContext('2d');
const viewbox = document.getElementById('viewbox');

const totalPages = 17;
const miniImages = [];

// Miniaturbilder laden
for (let i = 1; i <= totalPages; i++) {
  const img = new Image();
  img.src = `images/Seite${i}.png`; // relative Pfade!
  miniImages.push(img);
}

function drawMinimap() {
  const w = canvas.width = minimap.clientWidth;
  const h = canvas.height = minimap.clientHeight;

  ctx.clearRect(0, 0, w, h);

  const timelineWidth = timeline.scrollWidth;
  const scaleFactor = w / timelineWidth;

  // Miniaturbilder zeichnen
  miniImages.forEach((img, index) => {
    const x = timeline.children[index].offsetLeft * scaleFactor;
    const imgWidth = timeline.children[index].offsetWidth * scaleFactor;
    if (img.complete) ctx.drawImage(img, x, 0, imgWidth, h);
  });

  // Sichtbarer Ausschnitt (Viewbox)
  const visibleX = -translateX / targetScale;
  const visibleW = wrapper.clientWidth / targetScale;

  viewbox.style.left = visibleX * scaleFactor + minimap.offsetLeft + "px";
  viewbox.style.top = minimap.offsetTop + "px";
  viewbox.style.width = visibleW * scaleFactor + "px";
  viewbox.style.height = h + "px";
}

// Klick auf MiniMap
minimap.addEventListener('click', e => {
  const rect = minimap.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const scaleFactor = rect.width / timeline.scrollWidth;

  const targetX = -x / scaleFactor * targetScale + wrapper.clientWidth / 2;
  targetTranslateX = targetX;
  applyBounds();
});

function updateMinimap() {
  drawMinimap();
  requestAnimationFrame(updateMinimap);
}
updateMinimap();
</script>
